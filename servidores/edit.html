<!DOCTYPE html>
<html lang="pt-br">
<head>
	<meta charset="UTF-8" />
	<title>+Novo Servidor</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
	<script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	<script src="https://fasil.criarsite.online/dist/js/cep.js"></script>
	<style>
		body {
			background-color: #f4f6f9;
			font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
		}
		.navbar {
			background-color: #003366;
		}
		.navbar-brand, .nav-link {
			color: #fff !important;
		}
		.card {
			border: none;
			border-radius: 8px;
			box-shadow: 0 4px 12px rgba(0,0,0,0.05);
		}
		.form-label {
			margin-bottom: 0;
			font-weight: 600;
			color: #555;
		}
	
		.section-title {
			border-bottom: 2px solid #003366;
			padding-bottom: 0.3rem;
			margin-bottom: 1rem;
			font-size: 1.2rem;
			color: #003366;
		}
	</style>
</head>
<body>
	<div class="container mt-5">
	
	<h2 class="section-title">+Novo Servidor</h2>

	<form id="form-create" class="card p-4 mb-5">

		<fieldset class="border p-2 mb-2">
			
			<legend class="float-none w-auto mb-0 px-2 fw-bold" style="color: #003366;">Servidor</legend>
			
			<div class="row">
				
				<div class="col-8 mb-3">
					<label for="servidor" class="form-label">Nome:</label>
					<input type="text" id="servidor" class="form-control" required />
				</div>
				
				<div class="col-4 mb-3">
					<label for="genero" class="form-label">Gênero:</label>
					<select id="genero" class="form-select" required>
						<option value="">Gênero...</option>
						<option value="F">Feminino</option>
						<option value="M">Masculino</option>
					</select>
				</div>

			</div>
			
			<div class="row">

				<div class="col-md-6 mb-3">
					<label for="cpf" class="form-label">CPF:</label>
					<input type="text" id="cpf" class="form-control" maxlength="14" required />
				</div>
				
				<div class="col-md-6 mb-3">
					<label for="nascimento" class="form-label">Nascimento:</label>
					<input type="date" id="nascimento" class="form-control" required />
				</div>

			</div>

		</fieldset>

		<fieldset class="border p-2 mb-2">

			<legend class="float-none w-auto px-2 fw-bold" style="color: #003366;">Contato</legend>
			
			<div class="row g-2">
				
				<div class="col-md-6 mb-3">
					<label for="email" class="form-label">E-mail:</label>
					<input type="email" id="email" class="form-control" required />
				</div>
				
				<div class="col-md-6 mb-3">
					<label for="telefone" class="form-label">Telefone:</label>
					<input type="text" id="telefone" class="form-control" />
				</div>
			</div>
		
		</fieldset>

		<fieldset class="border p-2 mb-2">

			<legend class="float-none w-auto px-2 fw-bold" style="color: #003366;">Endereço</legend>

			<div class="row mb-3">

				<div class="col-md-3">
					<label for="cep" class="form-label">CEP:</label>
					<input type="text" id="cep" class="form-control" maxlength="8" required />
				</div>

				<div class="col-md-6">
					<label for="endereco" class="form-label">Endereço:</label>
					<input type="text" id="endereco" class="form-control" required />
				</div>
				
				<div class="col-md-3">
					<label for="numero" class="form-label">Número:</label>
					<input type="text" id="numero" class="form-control" required />
				</div>

			</div>

			<div class="row mb-3">

				<div class="col-md-3">
					<label for="bairro" class="form-label">Bairro:</label>
					<input type="text" id="bairro" class="form-control" required />
				</div>
				
				<div class="col-md-6">
					<label for="cidade" class="form-label">Cidade:</label>
					<input type="text" id="cidade" class="form-control" required />
				</div>
				
				<div class="col-md-3">
					<label for="uf" class="form-label">UF:</label>
					<input type="text" id="uf" class="form-control" maxlength="2" required />
				</div>
				
				
			</div>

		</fieldset>
		
		<button type="submit" class="btn btn-primary mb-2">+Novo Servidor</button>
		<button type="reset" class="btn btn-secondary px-4">Limpar</button>

	</form>

	</div>

<script src="js/api.js"></script>
<script>
	const params = new URLSearchParams(window.location.search);
	const id = params.get("id");

	fetchServidores().then(servidores => {
		const departamento = servidores.find(d => d.id == id);
		if (departamento) {
			document.getElementById("id").value = departamento.id;
			document.getElementById("departamento").value = departamento.servidor;
			document.getElementById("sigla").value = departamento.sigla;
			document.getElementById("descricao").value = departamento.descricao;
			document.getElementById("email").value = departamento.email;
			document.getElementById("telefone").value = departamento.telefone;
			document.getElementById("endereco").value = departamento.endereco;
			document.getElementById("numero").value = departamento.numero;
			document.getElementById("bairro").value = departamento.bairro;
			document.getElementById("cidade").value = departamento.cidade;
			document.getElementById("uf").value = departamento.uf;
			document.getElementById("cep").value = departamento.cep;
			document.getElementById("ip_at").textContent = departamento.ip_at;
		} else {
			alert("Servidor não encontrado.");
		}
	});
	
	document.getElementById("form-edit").addEventListener("submit", async (e) => {
		e.preventDefault();
		const data = {
			id: parseInt(document.getElementById("id").value),
			id_secretaria: parseInt(document.getElementById("id_secretaria").value),
			id_prefeitura: parseInt(document.getElementById("id_prefeitura").value),
			departamento: document.getElementById("departamento").value.trim(),
			sigla: document.getElementById("sigla").value.trim(),
			descricao: document.getElementById("descricao").value.trim(),
			email: document.getElementById("email").value.trim(),
			telefone: document.getElementById("telefone").value.trim(),
			endereco: document.getElementById("endereco").value.trim(),
			numero: document.getElementById("numero").value.trim(),
			bairro: document.getElementById("bairro").value.trim(),
			cidade: document.getElementById("cidade").value.trim(),
			uf: document.getElementById("uf").value,
			cep: document.getElementById("cep").value.trim(),
		};
		
		const sucesso = await atualizarServidor(data);
		if (sucesso) {
			alert("Servidor atualizado com sucesso!");
			window.location.href = "index.html";
		} else {
			alert("Erro ao atualizar o Servidor.");
		}
	});
</script>

</body>
</html>
